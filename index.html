<!doctype html>
<html lang="is">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SendGrid tools</title>
<style>
  /* Load Basic Sans for product card rendering */
  @font-face {
    font-family: "Basic Sans";
    src: url("./fonts/basicsans-regular.woff") format("woff");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }

  /* UI (tabs, inputs, labels, etc.) should NOT use Basic Sans */
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    margin: 24px;
    color: #111;
  }

  h1 { font-size: 20px; margin: 0 0 6px; }
  .muted { color:#666; font-size: 12px; margin: 0 0 14px; }

  /* Tabs */
  .tabs { display:flex; gap:8px; margin-bottom:14px; flex-wrap:wrap; }
  .tab-btn {
    cursor:pointer; padding:8px 12px; border-radius:10px; border:1px solid #111;
    background:#fff; color:#111; font-weight:700; font-size:13px;
  }
  .tab-btn.active { background:#111; color:#fff; }
  .tab { display:none; }
  .tab.active { display:block; }

  /* Shared layout */
  .wrap { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; align-items: start; }
  .panel { border: 1px solid #ddd; border-radius: 10px; padding: 14px; }
  .panel h2 { font-size: 16px; margin: 0 0 10px; }
  label { font-size: 12px; font-weight: 600; display:block; margin-top: 10px; }
  input { width:100%; padding:8px; border:1px solid #ccc; border-radius:8px; font-size:14px; }
  textarea {
    width:100%; min-height: 280px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size:12px; padding:10px; border:1px solid #ccc; border-radius:8px;
    white-space: pre; overflow:auto;
  }
  .preview { background:#fafafa; padding: 10px; border-radius: 8px; border:1px dashed #ccc; overflow:auto; }
  .btns { display:flex; gap:10px; margin-top: 12px; flex-wrap: wrap; }
  button {
    cursor:pointer; padding:8px 12px; border-radius:8px; border:1px solid #111;
    background:#111; color:#fff; font-weight:700;
  }
  button.ghost { background:#fff; color:#111; }
  .note { font-size:12px; color:#444; margin-top:8px; }

  /* 3-column input */
  .row3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; }

  /* UTM controls */
  .toggle-row { display:flex; align-items:center; gap:8px; margin-top: 6px; }
  .toggle-row input[type="checkbox"] { width:auto; transform: translateY(1px); }
  .utm-grid { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-top: 8px; }
  .utm-grid input { font-size:13px; }
  .small { font-size:12px; color:#555; margin-top:6px; }

  /* ---------------------------------------------------------- */
  /* FIXED-SIZE PRODUCT CARD PREVIEW (ALWAYS 512 × 604 PX)      */
  /* ---------------------------------------------------------- */
  .card-shell {
    width: 512px;               /* fixed width */
    height: 604px;              /* fixed height */
    border: 1px solid #D9D9D9;
    border-radius: 8px;
    background: #FFFFFF;
    overflow: hidden;
    box-sizing: border-box;
    margin-top: 14px;

    /* Basic Sans applied only to card content */
    font-family: "Basic Sans", Arial, sans-serif;
  }
</style>

</head>
<body>
  <h1>SendGrid marketing tools</h1>
  <p class="muted">Two-tools: 3 column block for code view + “Create card” from product url.</p>

  <div class="tabs">
    <button class="tab-btn active" data-tab="tab-3col">3-column block</button>
    <button class="tab-btn" data-tab="tab-card">Create card from url</button>
  </div>

  <!-- ===================== TAB 1: 3-column generator ===================== -->
  <section id="tab-3col" class="tab active">
    <div class="wrap">
      <div class="panel">
        <h2>3-column block</h2>

        <!-- UTM controls -->
        <div class="toggle-row">
          <input id="utmToggle3" type="checkbox" checked />
          <label for="utmToggle3" style="margin:0;">Bæta UTM á vörutengla</label>
        </div>
        <div class="utm-grid" id="utmFields3">
          <div>
            <label style="margin-top:8px;">utm_source</label>
            <input id="utmSource3" value="sendgrid" />
          </div>
          <div>
            <label style="margin-top:8px;">utm_medium</label>
            <input id="utmMedium3" value="email" />
          </div>
          <div>
            <label style="margin-top:8px;">utm_campaign</label>
            <input id="utmCampaign3" value="marketing_single_send" />
          </div>
        </div>
        <div class="small">Ef slökkt er á þessu, fara tenglar inn óbreyttir.</div>

        <div class="row3" id="inputs3col" style="margin-top:12px;"></div>

        <div class="btns">
          <button class="ghost" id="resetBtn3col" type="button">Hreinsa</button>
          <button id="copyBtn3col" type="button">Afrita HTML</button>
        </div>
        <div id="copyStatus3col" class="note"></div>
      </div>

      <div class="panel">
        <h2>Forskoðun</h2>
        <div class="preview" id="preview3col"></div>

        <h2 style="margin-top:14px;">Úttak (copy/paste í SendGrid)</h2>
        <textarea id="output3col" readonly></textarea>
      </div>
    </div>
  </section>

  <!-- ===================== TAB 2: Product card builder ===================== -->
  <section id="tab-card" class="tab">
    <div class="wrap">
      <div class="panel">
        <h2>Create card from url</h2>

        <label>Product URL (site.com/product/...)</label>
        <input id="productUrlCard" placeholder="https://site.com/product/1234567" />

        <div class="btns">
          <button id="createBtnCard" type="button">Create card</button>
          <button id="copyBtnCard" class="ghost" type="button">Copy HTML</button>
        </div>

        <div id="statusCard" class="note"></div>
      </div>

      <div class="panel">
        <h2>Forskoðun</h2>
        <div id="previewCard"></div>

        <h2 style="margin-top:14px;">Úttak (copy/paste)</h2>
        <textarea id="outputCard" readonly></textarea>
      </div>
    </div>
  </section>

<script>
/* ===================== Tabs ===================== */
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

/* ===================== TAB 1: 3-column generator ===================== */
const NUM_COLUMNS = 3;

const products3col = Array.from({ length: NUM_COLUMNS }, () => ({
  href: "",
  src: "",
  alt: ""
}));

const inputs3colEl = document.getElementById("inputs3col");
const output3colEl = document.getElementById("output3col");
const preview3colEl = document.getElementById("preview3col");
const copyBtn3col = document.getElementById("copyBtn3col");
const resetBtn3col = document.getElementById("resetBtn3col");
const copyStatus3col = document.getElementById("copyStatus3col");

const utmToggle3 = document.getElementById("utmToggle3");
const utmSource3 = document.getElementById("utmSource3");
const utmMedium3 = document.getElementById("utmMedium3");
const utmCampaign3 = document.getElementById("utmCampaign3");
const utmFields3 = document.getElementById("utmFields3");

function renderInputs3col() {
  inputs3colEl.innerHTML = "";
  products3col.forEach((p, idx) => {
    const card = document.createElement("div");
    card.innerHTML = `
      <div style="border:1px solid #eee;border-radius:10px;padding:10px;">
        <strong>Dálkur ${idx+1}</strong>

        <label>Vörutengill (href)</label>
        <input data-k="href" data-i="${idx}" placeholder="https://site.com/product/..." value="${p.href}"/>

        <label>Myndatengill (src)</label>
        <input data-k="src" data-i="${idx}" placeholder="http://cdn.mcauto-images...png" value="${p.src}"/>

        <label>Alt text (valfrjálst)</label>
        <input data-k="alt" data-i="${idx}" placeholder="t.d. Maiskökur" value="${p.alt}"/>
      </div>
    `;
    inputs3colEl.appendChild(card);
  });

  inputs3colEl.querySelectorAll("input").forEach(inp => {
    inp.addEventListener("input", e => {
      const i = Number(e.target.dataset.i);
      const k = e.target.dataset.k;
      products3col[i][k] = e.target.value.trim();
      update3col();
    });
  });
}

// YOUR TEMPLATE KEPT VERBATIM (placeholders only)
const TEMPLATE_3COL = String.raw`<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
  /* Mobile-only overrides (Gmail/Android friendly) */
  @media only screen and (max-width:640px),
         only screen and (max-device-width:640px) {

    .responsive-table, [class~="responsive-table"] {
      width: 100% !important;
      margin: 0 auto !important;
      padding: 0 !important; /* avoid double padding from wrapper */
    }

    .column, [class~="column"] {
      display: block !important;
      width: 100% !important;
      max-width: 100% !important;
      text-align: center !important;
      margin: 0 auto 20px !important;
      padding: 0 !important; /* prevent compounding widths */
    }

    /* Reliable 28px side gutters per card */
    .mobile-pad, [class~="mobile-pad"] {
      padding-left: 28px !important;
      padding-right: 28px !important;
    }

    .column img, [class~="column"] img {
      width: 100% !important;
      height: auto !important;
      max-width: 100% !important;
      display: block !important;
      margin: 0 auto !important;
    }
  }
  </style>
</head>

<body>
  <table class="responsive-table" width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse:collapse;">
    <tr>
      <!-- First Column -->
      <td class="column" width="33.33%" valign="top" style="padding:10px; font-size:14px; line-height:20px;">
        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
          <tr>
            <!-- Mobile adds 28px L/R here -->
            <td class="mobile-pad" style="padding:0;">
              <a href="{{href1}}">
                <img border="0" style="display:block; max-width:100%; width:100%; height:auto;" width="186" alt="{{alt1}}" src="{{src1}}">
              </a>
            </td>
          </tr>
        </table>
      </td>

      <!-- Second Column -->
      <td class="column" width="33.33%" valign="top" style="padding:10px; font-size:14px; line-height:20px;">
        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td class="mobile-pad" style="padding:0;">
              <a href="{{href2}}">
                <img border="0" style="display:block; max-width:100%; width:100%; height:auto;" width="186" alt="{{alt2}}" src="{{src2}}">
              </a>
            </td>
          </tr>
        </table>
      </td>

      <!-- Third Column -->
      <td class="column" width="33.33%" valign="top" style="padding:10px; font-size:14px; line-height:20px;">
        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td class="mobile-pad" style="padding:0;">
              <a href="{{href3}}">
                <img border="0" style="display:block; max-width:100%; width:100%; height:auto;" width="186" alt="{{alt3}}" src="{{src3}}">
              </a>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>`;

function buildHtml3col() {
  let html = TEMPLATE_3COL;

  products3col.forEach((p, idx) => {
    const n = idx + 1;

    const finalHref = utmToggle3.checked
      ? addUTM(p.href, {
          utm_source: utmSource3.value.trim(),
          utm_medium: utmMedium3.value.trim(),
          utm_campaign: utmCampaign3.value.trim()
        })
      : (p.href || "#");

    html = html
      .replaceAll(`{{href${n}}}`, finalHref || "#")
      .replaceAll(`{{src${n}}}`, p.src || "https://via.placeholder.com/512x604.png?text=Image")
      .replaceAll(`{{alt${n}}}`, escapeHtml(p.alt || ""));
  });

  return html.trim();
}

function update3col() {
  utmFields3.style.display = utmToggle3.checked ? "grid" : "none";
  const html = buildHtml3col();
  output3colEl.value = html;
  preview3colEl.innerHTML = html;
}

copyBtn3col.addEventListener("click", async () => {
  try {
    await navigator.clipboard.writeText(output3colEl.value);
    copyStatus3col.textContent = "Afritað! Límdu í SendGrid Code Block.";
    setTimeout(() => copyStatus3col.textContent = "", 1500);
  } catch {
    copyStatus3col.textContent = "Gat ekki afritað — afritaðu handvirkt.";
  }
});

resetBtn3col.addEventListener("click", () => {
  products3col.forEach(p => { p.href=""; p.src=""; p.alt=""; });
  renderInputs3col();
  update3col();
});

[utmToggle3, utmSource3, utmMedium3, utmCampaign3].forEach(el =>
  el.addEventListener("input", update3col)
);

/* ===================== TAB 2: Card builder ===================== */
/* EDIT THIS if your Worker URL changes */
const PROXY_URL =
  "https://workers-playground-patient-frog-cbe4.thorvaldura.workers.dev/?url=";

const productUrlCardEl = document.getElementById("productUrlCard");
const createBtnCard = document.getElementById("createBtnCard");
const copyBtnCard = document.getElementById("copyBtnCard");
const previewCardEl = document.getElementById("previewCard");
const outputCardEl = document.getElementById("outputCard");
const statusCardEl = document.getElementById("statusCard");

createBtnCard.addEventListener("click", async () => {
  const url = productUrlCardEl.value.trim();
  if (!url) return setStatusCard("Settu inn slóð.", true);

  setStatusCard("Sæki vöru…", false);
  previewCardEl.innerHTML = "";
  outputCardEl.value = "";

  try {
    const data = await fetch(PROXY_URL + encodeURIComponent(url)).then(r => r.json());

    if (!data?.name || !data?.price || !data?.image) {
      throw new Error("Missing fields in JSON");
    }

    const cardHtml = buildCardHtml(data);
    outputCardEl.value = cardHtml;
    previewCardEl.innerHTML = `<div class="card-shell">${cardHtml}</div>`;

    setStatusCard("Tilbúið ✅", false);
  } catch (e) {
    console.error(e);
    setStatusCard("Tókst ekki að sækja vöru. Athugaðu slóð eða proxy.", true);
  }
});

copyBtnCard.addEventListener("click", async () => {
  if (!outputCardEl.value) return;
  try {
    await navigator.clipboard.writeText(outputCardEl.value);
    setStatusCard("Afritað HTML ✅", false);
    setTimeout(()=>setStatusCard("",false), 1200);
  } catch {
    setStatusCard("Gat ekki afritað — afritaðu handvirkt.", true);
  }
});

function buildCardHtml(p) {
  // ====== STYLE CONSTANTS (from your Figma + mobile requirement) ======
  const CARD_WIDTH = 420;            // px (your mobile requirement)
  const CARD_HEIGHT = 171;           // px (Figma height; treated as min-height)
  const RADIUS = 8;                 // px
  const BORDER = "1px solid #D9D9D9";
  const BG = "#FFFFFF";

  const PAD = 12;                    // inner padding px (keep unless Figma says otherwise)

  const NAME_SIZE = 16;              // px (tweak if Figma text differs)
  const NAME_WEIGHT = 700;
  const NAME_COLOR = "#111111";
  const NAME_LINE = 1.25;

  const PRICE_SIZE = 15;             // px
  const PRICE_WEIGHT = 600;
  const PRICE_COLOR = "#111111";
  const PRICE_TOP = 6;              // px spacing above price

  const BTN_BG = "#111111";
  const BTN_COLOR = "#FFFFFF";
  const BTN_RADIUS = 8;              // keep aligned with card radius vibe
  const BTN_PAD_Y = 8;
  const BTN_PAD_X = 10;
  const BTN_SIZE = 13;
  const BTN_WEIGHT = 700;
  const BTN_TOP = 10;
  const BTN_TEXT = "Skoða vöru";
  // ================================================================

  return `
<!-- Product card -->
<table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0"
       style="border-collapse:collapse; max-width:${CARD_WIDTH}px; margin:0 auto;">
  <tr>
    <td style="
      border:${BORDER};
      border-radius:${RADIUS}px;
      overflow:hidden;
      background:${BG};
      min-height:${CARD_HEIGHT}px;
    ">
      <a href="${p.url}" target="_blank" style="text-decoration:none;">
        <img src="${p.image}" alt="${escapeHtml(p.name)}"
             style="display:block; width:100%; height:auto; border:0;" />
      </a>

      <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0"
             style="border-collapse:collapse;">
        <tr>
          <td style="padding:${PAD}px; font-family:Arial,sans-serif;">
            <div style="
              font-size:${NAME_SIZE}px;
              font-weight:${NAME_WEIGHT};
              line-height:${NAME_LINE};
              color:${NAME_COLOR};
              margin:0;
            ">${escapeHtml(p.name)}</div>

            <div style="
              margin-top:${PRICE_TOP}px;
              font-size:${PRICE_SIZE}px;
              font-weight:${PRICE_WEIGHT};
              line-height:1.2;
              color:${PRICE_COLOR};
            ">${escapeHtml(p.price)}</div>

            <a href="${p.url}" target="_blank" style="
              display:inline-block;
              margin-top:${BTN_TOP}px;
              padding:${BTN_PAD_Y}px ${BTN_PAD_X}px;
              border-radius:${BTN_RADIUS}px;
              background:${BTN_BG};
              color:${BTN_COLOR};
              text-decoration:none;
              font-weight:${BTN_WEIGHT};
              font-size:${BTN_SIZE}px;
              line-height:1;
            ">${BTN_TEXT}</a>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<!-- /Product card -->
`.trim();
}

function setStatusCard(msg, isError){
  statusCardEl.textContent = msg;
  statusCardEl.style.color = isError ? "#b00020" : "#333";
}

/* ===================== Helpers ===================== */
function escapeHtml(str) {
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function addUTM(url, utmObj) {
  if (!url) return "#";
  try {
    const u = new URL(url);
    Object.entries(utmObj).forEach(([k, v]) => {
      if (!v) return;
      if (!u.searchParams.has(k)) u.searchParams.set(k, v);
    });
    return u.toString();
  } catch {
    return url;
  }
}

/* Init */
renderInputs3col();
update3col();
</script>
</body>
</html>



